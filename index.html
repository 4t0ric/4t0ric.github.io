<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake Game</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: black;
    color: white;
    overflow: hidden;
  }
  #score, #powerup-timer, #achievements, #account {
    position: fixed;
    left: 10px;
    font-size: 20px;
    z-index: 10;
    user-select: none;
  }
  #score { top: 10px; }
  #powerup-timer { top: 40px; color: yellow; }
  #achievements { top: 70px; color: lime; }
  #account { bottom: 10px; }

  #settings-btn {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 10;
    padding: 8px 16px;
    font-size: 20px;
    background: #222;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  #settings-modal {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%,-50%) scale(0.9);
    background: rgba(0,0,0,0.9);
    padding: 20px;
    border-radius: 12px;
    z-index: 1000;
    display: none;
    min-width: 250px;
    max-height: 80%;
    overflow-y: auto;
  }
  #settings-modal.show {
    display: block;
    transform: translate(-50%,-50%) scale(1);
  }
  .setting-group { margin-bottom: 15px; }
  .setting-group label { font-weight: bold; display: block; margin-bottom: 6px; }

  .achievement-list { list-style: none; padding: 0; margin: 0; }
  .achievement-list li {
    margin: 4px 0;
    padding: 4px;
    border-radius: 4px;
  }
  .locked { color: gray; }
  .unlocked { color: lime; }
  canvas { display: block; }
</style>
</head>
<body>
  <div id="score">Score: 0</div>
  <div id="powerup-timer"></div>
  <div id="achievements"></div>
  <div id="account"></div>
  <button id="settings-btn">⚙️</button>
  <div id="settings-modal">
    <div class="setting-group">
      <label>Achievements</label>
      <ul id="achievement-list" class="achievement-list"></ul>
    </div>
    <div class="setting-group">
      <button id="close-settings">Close</button>
    </div>
  </div>
  <canvas id="game"></canvas>

<script>
(() => {
  const CELL_SIZE = 20;
  const POWERUPS = [
    {name:"halfSpeed", color:"blue", chance:0.05, duration:5000},
    {name:"invincibility", color:"gold", chance:0.02, duration:10000},
    {name:"+5score", color:"purple", chance:0.01, duration:10000}
  ];

  const SCORE_ACHIEVEMENTS = [67, 69, 50, 100, 200, 300, 400, 500];
  const ALL_ACHIEVEMENTS = [
    ...SCORE_ACHIEVEMENTS.map(s => "Score " + s),
    "literally snake!",
    "invincibility!"
  ];

  let canvas = document.getElementById("game");
  let ctx = canvas.getContext("2d");
  let width, height, columns, rows;

  let snake = [];
  let direction = "Right";
  let nextDirection = "Right";
  let food = null;
  let foodPowerup = null;
  let powerupActive = null;
  let powerupEndTime = 0;

  let score = 0;
  let gameOver = false;
  let updateDelay = 100;
  let lastUpdateTime = 0;

  let achievements = {};
  let accountCode = null;

  const scoreDiv = document.getElementById("score");
  const timerDiv = document.getElementById("powerup-timer");
  const achievDiv = document.getElementById("achievements");
  const accountDiv = document.getElementById("account");
  const settingsBtn = document.getElementById("settings-btn");
  const settingsModal = document.getElementById("settings-modal");
  const closeSettingsBtn = document.getElementById("close-settings");
  const achievementList = document.getElementById("achievement-list");

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
    columns = Math.floor(width / CELL_SIZE);
    rows = Math.floor(height / CELL_SIZE);
  }

  function resetGame() {
    gameOver = false;
    score = 0;
    direction = "Right";
    nextDirection = "Right";
    snake = [
      {x: Math.floor(columns/2), y: Math.floor(rows/2)},
      {x: Math.floor(columns/2)-1, y: Math.floor(rows/2)}
    ];
    placeFood();
    updateUI();
  }

  function placeFood() {
    while (true) {
      let x = Math.floor(Math.random() * columns);
      let y = Math.floor(Math.random() * rows);
      if (!snake.some(seg => seg.x===x && seg.y===y)) {
        food = {x,y};
        foodPowerup = null;
        for (let p of POWERUPS) {
          if (Math.random() < p.chance) {
            foodPowerup = p;
            break;
          }
        }
        break;
      }
    }
  }

  function activatePowerup(powerup) {
    powerupActive = powerup;
    powerupEndTime = Date.now() + powerup.duration;
    if (powerup.name === "halfSpeed") {
      updateDelay *= 2;
      unlockAchievement("literally snake!");
    } else if (powerup.name === "invincibility") {
      unlockAchievement("invincibility!");
    } else if (powerup.name === "+5score") {
      score += 5;
    }
  }

  function unlockAchievement(name) {
    if (!achievements[name]) {
      achievements[name] = true;
      achievDiv.textContent = "Achievement unlocked: " + name;
      setTimeout(()=>{achievDiv.textContent="";}, 4000);
      saveAccount();
      renderAchievementList();
    }
  }

  function checkScoreAchievements() {
    SCORE_ACHIEVEMENTS.forEach(val => {
      if (score >= val) {
        unlockAchievement("Score " + val);
      }
    });
  }

  function updateUI() {
    scoreDiv.textContent = "Score: " + score;
    if (powerupActive) {
      let remaining = Math.max(0, powerupEndTime - Date.now());
      timerDiv.textContent = powerupActive.name + " " + (remaining/1000).toFixed(1)+"s";
    } else {
      timerDiv.textContent = "";
    }
  }

  function drawCell(x,y,color) {
    ctx.fillStyle = color;
    ctx.fillRect(x*CELL_SIZE,y*CELL_SIZE,CELL_SIZE,CELL_SIZE);
  }

  function draw() {
    ctx.clearRect(0,0,width,height);
    drawCell(food.x, food.y, foodPowerup ? foodPowerup.color : "red");
    snake.forEach((seg,i)=>drawCell(seg.x,seg.y,i===0?"lime":"green"));
  }

  function update(timestamp) {
    if (!lastUpdateTime) lastUpdateTime = timestamp;
    if (timestamp - lastUpdateTime < updateDelay) {
      requestAnimationFrame(update); return;
    }
    lastUpdateTime = timestamp;

    if (gameOver) {requestAnimationFrame(update); return;}

    if (powerupActive && Date.now()>powerupEndTime) {
      if (powerupActive.name==="halfSpeed") updateDelay/=2;
      powerupActive=null;
    }

    direction = nextDirection;
    let head={...snake[0]};
    if (direction==="Right") head.x++;
    if (direction==="Left") head.x--;
    if (direction==="Up") head.y--;
    if (direction==="Down") head.y++;

    let hitWall = head.x<0||head.x>=columns||head.y<0||head.y>=rows;
    let hitSelf = snake.some(seg=>seg.x===head.x&&seg.y===head.y);

    if ((hitWall||hitSelf) && !(powerupActive && powerupActive.name==="invincibility")) {
      gameOver=true;
      saveAccount();
      requestAnimationFrame(update);
      return;
    }

    snake.unshift(head);
    if (head.x===food.x && head.y===food.y) {
      score++;
      if (foodPowerup) activatePowerup(foodPowerup);
      checkScoreAchievements();
      placeFood();
    } else {
      snake.pop();
    }
    updateUI();
    draw();
    requestAnimationFrame(update);
  }

  window.addEventListener("keydown", e=>{
    const map={ArrowUp:"Up",ArrowDown:"Down",ArrowLeft:"Left",ArrowRight:"Right",w:"Up",s:"Down",a:"Left",d:"Right"};
    let dir=map[e.key];
    if (dir) nextDirection=dir;
    if (e.key==="r"&&gameOver) resetGame();
  });

  function saveAccount() {
    let data={score,achievements};
    accountCode = btoa(JSON.stringify(data));
    accountDiv.textContent="Account code: "+accountCode;
  }

  function renderAchievementList() {
    achievementList.innerHTML="";
    ALL_ACHIEVEMENTS.forEach(a=>{
      let li=document.createElement("li");
      li.textContent=a;
      li.className=achievements[a]?"unlocked":"locked";
      achievementList.appendChild(li);
    });
  }

  // Settings modal handling
  settingsBtn.addEventListener("click", ()=>{
    settingsModal.classList.add("show");
    renderAchievementList();
  });
  closeSettingsBtn.addEventListener("click", ()=>{
    settingsModal.classList.remove("show");
  });

  function init() {
    resize();
    resetGame();
    requestAnimationFrame(update);
  }
  window.addEventListener("resize", resize);
  init();
})();
</script>
</body>
</html>
