<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake Game</title>
  <style>
    :root {
      --bg-dark: #000;
      --bg-light: #f4f4f4;
      --text-dark: #fff;
      --text-light: #111;
      --btn-bg-dark: #222;
      --btn-bg-light: #ddd;
      --btn-text-dark: #eee;
      --btn-text-light: #111;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-dark);
      overflow: hidden;
      transition: background-color 0.4s, color 0.4s;
    }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 24px;
      z-index: 10;
      user-select: none;
    }
    #highscore {
      position: fixed;
      top: 40px;
      left: 10px;
      font-size: 20px;
      z-index: 10;
      user-select: none;
    }
    #game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: red;
      font-size: 36px;
      text-align: center;
      display: none;
      z-index: 100;
      user-select: none;
      cursor: pointer;
    }
    #powerup-bar-container {
      position: fixed;
      top: 70px;
      left: 10px;
      width: 200px;
      height: 20px;
      background-color: #444;
      border-radius: 8px;
      overflow: hidden;
      display: none;
      z-index: 10;
    }
    #powerup-bar {
      width: 100%;
      height: 100%;
      background-color: orange;
      transition: width 0.1s linear, background-color 0.3s;
    }
    #settings-btn, #achievements-btn {
      position: fixed;
      top: 10px;
      z-index: 10;
      padding: 8px 16px;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }
    #settings-btn { right: 10px; background-color: var(--btn-bg-dark); color: var(--btn-text-dark); }
    #achievements-btn { right: 140px; background-color: var(--btn-bg-dark); color: var(--btn-text-dark); }
    #settings-btn:hover, #achievements-btn:hover {
      background-color: var(--btn-text-dark); color: var(--btn-bg-dark);
    }
    .light-theme #settings-btn, .light-theme #achievements-btn {
      background-color: var(--btn-bg-light); color: var(--btn-text-light);
    }
    .light-theme #settings-btn:hover, .light-theme #achievements-btn:hover {
      background-color: var(--btn-text-light); color: var(--btn-bg-light);
    }
    #settings-modal, #achievements-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #000;
      z-index: 1000;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
      min-width: 260px;
      user-select: none;
    }
    #settings-modal { background-color: rgba(0,0,0,0.9); color: var(--text-dark); }
    #achievements-modal { background-color: rgba(0,0,0,0.9); color: var(--text-dark); }
    #settings-modal.show {
      display: block; opacity: 1; transform: translate(-50%, -50%) scale(1);
    }
    .setting-group { margin-bottom: 18px; }
    .setting-group label { display: block; margin-bottom: 6px; font-weight: bold; }
    .setting-group button, .setting-group textarea {
      width: 100%; padding: 8px; margin-top: 4px; font-size: 14px; border: none; border-radius: 6px;
      cursor: pointer; background-color: var(--btn-bg-dark); color: var(--btn-text-dark);
      transition: background-color 0.3s, color 0.3s;
    }
    .setting-group button:hover { background-color: var(--btn-text-dark); color: var(--btn-bg-dark); }
    .setting-group textarea { resize: none; height: 60px; font-family: monospace; }
    .light-theme #settings-modal, .light-theme #achievements-modal { background-color: #fff; color: var(--text-light); box-shadow: 0 0 12px #aaa; }
    .light-theme .setting-group button { background-color: var(--btn-bg-light); color: var(--btn-text-light); }
    .light-theme .setting-group button:hover { background-color: var(--btn-text-light); color: var(--btn-bg-light); }
    canvas { display: block; }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <div id="highscore">Highscore: 0</div>
  <div id="powerup-bar-container"><div id="powerup-bar"></div></div>
  <div id="game-over">
    Game Over!<br>
    Tap or press R to Restart<br>
    Control the snake with WASD or swipe on mobile!
  </div>
  <button id="settings-btn">‚öôÔ∏è</button>
  <button id="achievements-btn">üèÜ</button>

  <div id="settings-modal">
    <div class="setting-group">
      <label>Difficulty</label>
      <button data-speed="150" class="difficulty-btn">Easy</button>
      <button data-speed="100" class="difficulty-btn">Medium</button>
      <button data-speed="70" class="difficulty-btn">Hard</button>
    </div>
    <div class="setting-group">
      <label>Theme</label><button id="theme-toggle">Toggle Dark / Light</button>
    </div>
    <div class="setting-group">
      <label>Grid</label><button id="grid-toggle">Toggle Grid</button>
    </div>
    <div class="setting-group">
      <label>Account Code</label>
      <textarea id="account-code" readonly></textarea>
      <button id="copy-code">Copy Code</button>
      <button id="load-code">Load from Code</button>
    </div>
    <div class="setting-group"><button id="close-settings">Close</button></div>
  </div>

  <div id="achievements-modal">
    <h2>Achievements</h2>
    <div id="achievements-list-modal" style="max-height:200px; overflow-y:auto;"></div>
    <button id="close-achievements" style="margin-top:10px;">Close</button>
  </div>

  <canvas id="game"></canvas>

  <script>
(() => {
  const CELL_SIZE = 20;
  const POWERUP_DURATION = { orange: 20000, half: 5000, inv: 10000, score: 10000 };

  let canvas = document.getElementById("game");
  let ctx = canvas.getContext("2d");
  let width, height, columns, rows;
  let snake = [], direction = "Right", nextDirection = "Right";
  let food = null, foodIsPowerup = false;
  let powerupActive = false, powerupEndTime = 0, powerupType = "";
  let snakeColor = "green", score = 0, gameOver = false, showGrid = false, darkTheme = true;
  let updateDelay = 100, lastUpdateTime = 0, gamePaused = false;

  const scoreDiv = document.getElementById("score");
  const highscoreDiv = document.getElementById("highscore");
  const gameOverDiv = document.getElementById("game-over");
  const powerupBarContainer = document.getElementById("powerup-bar-container");
  const powerupBar = document.getElementById("powerup-bar");
  const settingsBtn = document.getElementById("settings-btn");
  const achievementsBtn = document.getElementById("achievements-btn");
  const settingsModal = document.getElementById("settings-modal");
  const achievementsModal = document.getElementById("achievements-modal");
  const themeToggleBtn = document.getElementById("theme-toggle");
  const gridToggleBtn = document.getElementById("grid-toggle");
  const closeSettingsBtn = document.getElementById("close-settings");
  const closeAchievementsBtn = document.getElementById("close-achievements");
  const difficultyButtons = document.querySelectorAll(".difficulty-btn");
  const accountCodeBox = document.getElementById("account-code");
  const copyCodeBtn = document.getElementById("copy-code");
  const loadCodeBtn = document.getElementById("load-code");

  let account = { highscore:0, achievements:{} };
  const achievementScores = [41,50,67,69,100,150,200,250,300,350,400,450,500];

  function encodeAccount(obj){return btoa(JSON.stringify(obj));}
  function decodeAccount(code){try{return JSON.parse(atob(code));}catch{return null;}}
  function saveAccount(){ localStorage.setItem("snakeAccount", JSON.stringify(account)); accountCodeBox.value = encodeAccount(account); highscoreDiv.textContent = "Highscore: "+account.highscore; }
  function loadAccount(){ let data=localStorage.getItem("snakeAccount"); if(data) account=JSON.parse(data); if(!account.achievements) account.achievements={}; accountCodeBox.value=encodeAccount(account); highscoreDiv.textContent="Highscore:"+account.highscore; }

  function resize(){ width=window.innerWidth; height=window.innerHeight; canvas.width=width; canvas.height=height; columns=Math.floor(width/CELL_SIZE); rows=Math.floor(height/CELL_SIZE); }
  function resetGame(){ snakeColor=darkTheme?"green":"#007700"; powerupActive=false; powerupType=""; powerupEndTime=0; powerupBarContainer.style.display="none"; gameOver=false; score=0; direction=nextDirection="Right"; const startX=Math.floor(columns/2), startY=Math.floor(rows/2); snake=[{x:startX,y:startY},{x:startX-1,y:startY},{x:startX-2,y:startY}]; placeFood(); scoreDiv.textContent="Score:"+score; gameOverDiv.style.display="none"; }

  function placeFood(){
    while(true){
      let x=Math.floor(Math.random()*columns), y=Math.floor(Math.random()*rows);
      if(!snake.some(seg=>seg.x===x && seg.y===y)){
        food={x,y};
        let r=Math.random();
        if(r<0.05) foodIsPowerup="orange";
        else if(r<0.10) foodIsPowerup="half";
        else if(r<0.12) foodIsPowerup="inv";
        else if(r<0.13) foodIsPowerup="score";
        else foodIsPowerup=false;
        break;
      }
    }
  }

  function activatePowerup(type){
    powerupActive=true; powerupType=type; powerupBarContainer.style.display="block";
    switch(type){
      case "orange": snakeColor="orange"; powerupEndTime=Date.now()+POWERUP_DURATION.orange; powerupBar.style.backgroundColor="orange"; break;
      case "half": snakeColor="blue"; powerupEndTime=Date.now()+POWERUP_DURATION.half; powerupBar.style.backgroundColor="blue"; break;
      case "inv": snakeColor="cyan"; powerupEndTime=Date.now()+POWERUP_DURATION.inv; powerupBar.style.backgroundColor="cyan"; break;
      case "score": snakeColor="magenta"; powerupEndTime=Date.now()+POWERUP_DURATION.score; powerupBar.style.backgroundColor="magenta"; break;
    }
  }

  function drawCell(x,y,color){ ctx.fillStyle=color; ctx.fillRect(x*CELL_SIZE,y*CELL_SIZE,CELL_SIZE,CELL_SIZE); ctx.strokeStyle=darkTheme?"#222":"#ccc"; ctx.lineWidth=1; ctx.strokeRect(x*CELL_SIZE,y*CELL_SIZE,CELL_SIZE,CELL_SIZE); }
  function drawGrid(){ ctx.strokeStyle=darkTheme?"#222":"#ccc"; ctx.lineWidth=1; for(let x=0;x<=columns;x++){ctx.beginPath(); ctx.moveTo(x*CELL_SIZE,0); ctx.lineTo(x*CELL_SIZE,rows*CELL_SIZE); ctx.stroke();} for(let y=0;y<=rows;y++){ctx.beginPath(); ctx.moveTo(0,y*CELL_SIZE); ctx.lineTo(columns*CELL_SIZE,y*CELL_SIZE); ctx.stroke();} }
  function draw(){ ctx.clearRect(0,0,width,height); if(showGrid) drawGrid(); drawCell(food.x,food.y,foodIsPowerup?{"orange":"orange","half":"blue","inv":"cyan","score":"magenta"}[foodIsPowerup]||"red"); snake.forEach((seg,i)=>drawCell(seg.x,seg.y,i===0?"lime":snakeColor)); }

  function endGame(){ gameOver=true; gameOverDiv.style.display="block"; powerupBarContainer.style.display="none"; if(score>account.highscore){account.highscore=score; saveAccount();} }
  function checkAchievements(){ achievementScores.forEach(val=>{ if(score>=val && !account.achievements[val]){ account.achievements[val]=true; alert("Achievement unlocked: "+val+" points!"); saveAccount(); } }); }
  function renderAchievementsModal(){ const container=document.getElementById("achievements-list-modal"); container.innerHTML=""; achievementScores.forEach(scoreVal=>{ const unlocked=account.achievements[scoreVal]; const div=document.createElement("div"); div.textContent=scoreVal+" points"; div.style.color=unlocked?"lime":(darkTheme?"#888":"#555"); container.appendChild(div); }); }

  function update(timestamp){
    if(!lastUpdateTime) lastUpdateTime=timestamp;
    if(timestamp-lastUpdateTime<updateDelay){ requestAnimationFrame(update); return; }
    lastUpdateTime=timestamp;
    if(gameOver||gamePaused){ requestAnimationFrame(update); return; }

    if(powerupActive){
      let remaining=(powerupEndTime-Date.now())/POWERUP_DURATION[powerupType];
      if(remaining<=0){ powerupActive=false; powerupType=""; snakeColor=darkTheme?"green":"#007700"; powerupBarContainer.style.display="none"; } 
      else powerupBar.style.width=(remaining*100)+"%";
    }

    const opposites={Up:"Down",Down:"Up",Left:"Right",Right:"Left"};
    if(nextDirection!==opposites[direction]) direction=nextDirection;
    let head={...snake[0]};
    switch(direction){ case "Right": head.x++; break; case "Left": head.x--; break; case "Up": head.y--; break; case "Down": head.y++; break; }
    if(head.x<0||head.x>=columns||head.y<0||snake.some(seg=>seg.x===head.x&&seg.y===head.y)){ endGame(); requestAnimationFrame(update); return; }
    snake.unshift(head);
    if(head.x===food.x && head.y===food.y){ score++; scoreDiv.textContent="Score:"+score; if(foodIsPowerup) activatePowerup(foodIsPowerup); placeFood(); checkAchievements(); } else { snake.pop(); }
    draw(); requestAnimationFrame(update);
  }

  window.addEventListener("keydown",e=>{ if(gameOver&&(e.key==="r"||e.key==="R")){ resetGame(); return; } const map={ArrowUp:"Up",ArrowDown:"Down",ArrowLeft:"Left",ArrowRight:"Right",w:"Up",s:"Down",a:"Left",d:"Right"}; let dir=map[e.key]; if(!dir) return; const opposites={Up:"Down",Down:"Up",Left:"Right",Right:"Left"}; if(dir!==opposites[direction]) nextDirection=dir; });

  let touchStartX=null, touchStartY=null, SWIPE_THRESHOLD=30;
  canvas.addEventListener("touchstart",e=>{ e.preventDefault(); if(gameOver){ resetGame(); return; } const touch=e.touches[0]; touchStartX=touch.clientX; touchStartY=touch.clientY; },{passive:false});
  canvas.addEventListener("touchend",e=>{ e.preventDefault(); if(touchStartX===null||touchStartY===null) return; const touch=e.changedTouches[0]; let dx=touch.clientX-touchStartX, dy=touch.clientY-touchStartY; if(Math.abs(dx)<SWIPE_THRESHOLD&&Math.abs(dy)<SWIPE_THRESHOLD){ if(gameOver) resetGame(); touchStartX=null; touchStartY=null; return; } if(Math.abs(dx)>Math.abs(dy)){ if(dx>0&&direction!=="Left") nextDirection="Right"; else if(dx<0&&direction!=="Right") nextDirection="Left"; }else{ if(dy>0&&direction!=="Up") nextDirection="Down"; else if(dy<0&&direction!=="Down") nextDirection="Up"; } touchStartX=null; touchStartY=null; },{passive:false});

  gameOverDiv.addEventListener("click",()=>{ if(gameOver) resetGame(); });

  settingsBtn.addEventListener("click",()=>{ settingsModal.classList.toggle("show"); gamePaused=settingsModal.classList.contains("show"); });
  closeSettingsBtn.addEventListener("click",()=>{ settingsModal.classList.remove("show"); gamePaused=false; });
  achievementsBtn.addEventListener("click",()=>{ renderAchievementsModal(); achievementsModal.style.display="block"; achievementsModal.style.opacity="1"; achievementsModal.style.transform="translate(-50%, -50%) scale(1)"; gamePaused=true; });
  closeAchievementsBtn.addEventListener("click",()=>{ achievementsModal.style.display="none"; achievementsModal.style.opacity="0"; achievementsModal.style.transform="translate(-50%, -50%) scale(0.9)"; gamePaused=false; });
  difficultyButtons.forEach(btn=>{ btn.addEventListener("click",()=>{ updateDelay=parseInt(btn.dataset.speed,10); settingsModal.classList.remove("show"); gamePaused=false; }); });
  themeToggleBtn.addEventListener("click",()=>{ darkTheme=!darkTheme; document.body.classList.toggle("light-theme", !darkTheme); snakeColor=darkTheme?"green":"#007700"; draw(); renderAchievementsModal(); });
  gridToggleBtn.addEventListener("click",()=>{ showGrid=!showGrid; draw(); });
  copyCodeBtn.addEventListener("click",()=>{ accountCodeBox.select(); document.execCommand("copy"); });
  loadCodeBtn.addEventListener("click",()=>{ let code=prompt("Paste your account code:"); let acc=decodeAccount(code); if(acc && typeof acc.highscore==="number"){ account=acc; if(!account.achievements) account.achievements={}; saveAccount(); renderAchievementsModal(); alert("Account loaded!"); }else alert("Invalid code!"); });

  function init(){ resize(); resetGame(); loadAccount(); renderAchievementsModal(); requestAnimationFrame(update); }
  window.addEventListener("resize",()=>{ resize(); draw(); });
  init();
})();
  </script>
</body>
</html>
