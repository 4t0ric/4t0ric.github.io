<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake Game</title>
  <style>
    :root {
      --bg-dark: black;
      --bg-light: #f4f4f4;
      --text-dark: white;
      --text-light: black;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-dark);
      overflow: hidden;
      transition: background-color 0.4s, color 0.4s;
    }

    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 20px;
      z-index: 10;
    }

    #game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: red;
      font-size: 32px;
      text-align: center;
      display: none;
      z-index: 11;
    }

    canvas {
      display: block;
    }

    #settings-btn {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 10;
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: inherit;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.3s;
    }

    #settings-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    #settings-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      background: rgba(0, 0, 0, 0.95);
      color: white;
      padding: 20px;
      border-radius: 12px;
      z-index: 20;
      display: none;
      opacity: 0;
      transition: all 0.3s ease;
    }

    #settings-modal.show {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .modal-option {
      margin-bottom: 12px;
    }

    select, button {
      padding: 6px 12px;
      margin-left: 10px;
      font-size: 14px;
    }

    .btn {
      border: none;
      border-radius: 6px;
      background-color: #333;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }

    .btn:hover {
      background-color: #555;
    }

    .light-theme {
      background: var(--bg-light);
      color: var(--text-light);
    }

    .light-theme #settings-modal {
      background: white;
      color: black;
    }

    .light-theme .btn {
      background: #ccc;
      color: black;
    }

    .light-theme .btn:hover {
      background: #aaa;
    }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <div id="game-over">Game Over!<br />Press R to Restart</div>
  <button id="settings-btn" class="btn">⚙️</button>
  <div id="settings-modal">
    <div class="modal-option">
      Difficulty:
      <select id="difficulty">
        <option value="150">Easy</option>
        <option value="100" selected>Medium</option>
        <option value="60">Hard</option>
      </select>
    </div>
    <div class="modal-option">
      Theme:
      <button id="theme-toggle" class="btn">Toggle Dark/Light</button>
    </div>
    <div class="modal-option">
      Show Grid:
      <button id="grid-toggle" class="btn">Toggle Grid</button>
    </div>
    <button id="close-settings" class="btn">Close</button>
  </div>
  <canvas id="game"></canvas>

  <script>
    (() => {
      const CELL_SIZE = 20;
      let canvas, ctx;
      let width, height, columns, rows;
      let snake, direction, food, foodIsPowerup;
      let score = 0, gameOver = false;
      let powerupActive = false, powerupEndTime = 0;
      let snakeColor = "green";
      let darkTheme = true;
      let showGrid = false;
      let updateDelay = 100;
      let lastUpdateTime = 0;

      const scoreDiv = document.getElementById("score");
      const gameOverDiv = document.getElementById("game-over");
      const modal = document.getElementById("settings-modal");
      const canvasEl = document.getElementById("game");

      function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        columns = Math.floor(width / CELL_SIZE);
        rows = Math.floor(height / CELL_SIZE);
      }

      function resetGame() {
        snakeColor = darkTheme ? "green" : "#007700";
        powerupActive = false;
        powerupEndTime = 0;
        gameOver = false;
        score = 0;
        direction = "ArrowRight";
        snake = [
          {x: 10, y: 10},
          {x: 9, y: 10},
          {x: 8, y: 10}
        ];
        placeFood();
        scoreDiv.textContent = "Score: " + score;
        gameOverDiv.style.display = "none";
      }

      function placeFood() {
        while (true) {
          let x = Math.floor(Math.random() * columns);
          let y = Math.floor(Math.random() * rows);
          if (!snake.some(seg => seg.x === x && seg.y === y)) {
            food = {x, y};
            foodIsPowerup = Math.random() < 0.05;
            break;
          }
        }
      }

      function drawCell(x, y, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        ctx.strokeStyle = darkTheme ? "#222" : "#aaa";
        ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
      }

      function drawGrid() {
        ctx.strokeStyle = darkTheme ? "#222" : "#aaa";
        for (let x = 0; x < columns; x++) {
          for (let y = 0; y < rows; y++) {
            ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
          }
        }
      }

      function draw() {
        ctx.clearRect(0, 0, width, height);
        if (showGrid) drawGrid();
        drawCell(food.x, food.y, foodIsPowerup ? "orange" : "red");
        snake.forEach((seg, i) => {
          drawCell(seg.x, seg.y, i === 0 ? "lime" : snakeColor);
        });
      }

      function updateSnake() {
        if (powerupActive && Date.now() > powerupEndTime) {
          powerupActive = false;
          snakeColor = darkTheme ? "green" : "#007700";
        }

        let head = {...snake[0]};
        switch(direction) {
          case "ArrowRight": head.x += 1; break;
          case "ArrowLeft": head.x -= 1; break;
          case "ArrowUp": head.y -= 1; break;
          case "ArrowDown": head.y += 1; break;
        }

        if (head.x < 0 || head.x >= columns || head.y < 0 || head.y >= rows || snake.some(seg => seg.x === head.x && seg.y === head.y)) {
          gameOver = true;
          gameOverDiv.style.display = "block";
          return;
        }

        snake.unshift(head);
        if (head.x === food.x && head.y === food.y) {
          score++;
          scoreDiv.textContent = "Score: " + score;
          if (foodIsPowerup) {
            powerupActive = true;
            snakeColor = "orange";
            powerupEndTime = Date.now() + 10000;
          }
          placeFood();
        } else {
          snake.pop();
        }
        draw();
      }

      function gameLoop(timestamp) {
        if (!lastUpdateTime || timestamp - lastUpdateTime > updateDelay) {
          if (!gameOver) updateSnake();
          lastUpdateTime = timestamp;
        }
        requestAnimationFrame(gameLoop);
      }

      function initControls() {
        window.addEventListener("keydown", (e) => {
          const keys = ["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"];
          const opposites = {
            "ArrowUp": "ArrowDown",
            "ArrowDown": "ArrowUp",
            "ArrowLeft": "ArrowRight",
            "ArrowRight": "ArrowLeft"
          };
          if (gameOver && (e.key === "r" || e.key === "R")) {
            resetGame();
          } else if (keys.includes(e.key) && direction !== opposites[e.key]) {
            direction = e.key;
          }
        });

        // Swipe gestures
        let touchStartX, touchStartY;
        canvas.addEventListener("touchstart", e => {
          const touch = e.touches[0];
          touchStartX = touch.clientX;
          touchStartY = touch.clientY;
        });

        canvas.addEventListener("touchend", e => {
          const dx = e.changedTouches[0].clientX - touchStartX;
          const dy = e.changedTouches[0].clientY - touchStartY;
          if (Math.abs(dx) > Math.abs(dy)) {
            direction = dx > 0 ? "ArrowRight" : "ArrowLeft";
          } else {
            direction = dy > 0 ? "ArrowDown" : "ArrowUp";
          }
        });
      }

      function initSettings() {
        document.getElementById("settings-btn").onclick = () => {
          modal.classList.add("show");
        };
        document.getElementById("close-settings").onclick = () => {
          modal.classList.remove("show");
        };

        document.getElementById("difficulty").onchange = (e) => {
          updateDelay = parseInt(e.target.value);
        };

        document.getElementById("theme-toggle").onclick = () => {
          darkTheme = !darkTheme;
          document.body.classList.toggle("light-theme", !darkTheme);
          snakeColor = darkTheme ? "green" : "#007700";
          draw();
        };

        document.getElementById("grid-toggle").onclick = () => {
          showGrid = !showGrid;
          draw();
        };
      }

      canvas = canvasEl;
      ctx = canvas.getContext("2d");
      resize();
      resetGame();
      initControls();
      initSettings();
      window.addEventListener("resize", resize);
      requestAnimationFrame(gameLoop);
    })();
  </script>
</body>
</html>
